

{% block extrahead %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="superuser-password-reset">
    <div class="auth-container">
        <div class="auth-header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 40C31.0457 40 40 31.0457 40 20C40 8.9543 31.0457 0 20 0C8.9543 0 0 8.9543 0 20C0 31.0457 8.9543 40 20 40Z" fill="#4361EE"/>
                    <path d="M22.5 15H17.5C16.1193 15 15 16.1193 15 17.5V22.5C15 23.8807 16.1193 25 17.5 25H22.5C23.8807 25 25 23.8807 25 22.5V17.5C25 16.1193 23.8807 15 22.5 15Z" fill="white"/>
                    <path d="M22.5 15V12.5C22.5 11.1193 21.3807 10 20 10C18.6193 10 17.5 11.1193 17.5 12.5V15" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>پنل مدیریت</span>
            </div>
            <h1>تغییر رمز عبور مدیریتی</h1>
            <p class="subtitle">به عنوان کاربر سطح دسترسی بالا می‌توانید رمز خود را مستقیماً به روزرسانی کنید</p>
        </div>

        <div class="auth-card">
            <form method="POST" class="auth-form">
                {% csrf_token %}

                {% if form.errors %}
                <div class="alert alert-error">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM11 15H9V13H11V15ZM11 11H9V5H11V11Z" fill="#DC2626"/>
                    </svg>
                    <div>
                        <strong>خطا در فرم:</strong>
                        <ul>
                            {% for field, errors in form.errors.items %}
                                {% for error in errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}

                <div class="form-group">
                    <label for="id_new_password">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15 9H16C16.5523 9 17 9.44772 17 10V17C17 17.5523 16.5523 18 16 18H4C3.44772 18 3 17.5523 3 17V10C3 9.44772 3.44772 9 4 9H5V7C5 4.23858 7.23858 2 10 2C12.7614 2 15 4.23858 15 7V9ZM13 9V7C13 5.34315 11.6569 4 10 4C8.34315 4 7 5.34315 7 7V9H13ZM11 13C11 13.5523 10.5523 14 10 14C9.44772 14 9 13.5523 9 13C9 12.4477 9.44772 12 10 12C10.5523 12 11 12.4477 11 13Z" fill="#64748B"/>
                        </svg>
                        رمز عبور جدید
                    </label>
                    <div class="password-input">
                        <input
                            type="password"
                            name="new_password"
                            id="id_new_password"
                            required
                            placeholder="حداقل 8 کاراکتر"
                            autocomplete="new-password"
                        >
                        <button type="button" class="toggle-password">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9.99992 4.16675C5.83325 4.16675 2.27492 6.66675 0.833252 10.4167C2.27492 14.1667 5.83325 16.6667 9.99992 16.6667C14.1666 16.6667 17.7249 14.1667 19.1666 10.4167C17.7249 6.66675 14.1666 4.16675 9.99992 4.16675ZM9.99992 14.5834C7.69992 14.5834 5.83325 12.7167 5.83325 10.4167C5.83325 8.11675 7.69992 6.25008 9.99992 6.25008C12.2999 6.25008 14.1666 8.11675 14.1666 10.4167C14.1666 12.7167 12.2999 14.5834 9.99992 14.5834ZM9.99992 7.91675C8.61659 7.91675 7.49992 9.03341 7.49992 10.4167C7.49992 11.8001 8.61659 12.9167 9.99992 12.9167C11.3833 12.9167 12.4999 11.8001 12.4999 10.4167C12.4999 9.03341 11.3833 7.91675 9.99992 7.91675Z" fill="#64748B"/>
                            </svg>
                        </button>
                    </div>
                    <div class="password-strength">
                        <div class="strength-meter"></div>
                    </div>
                    <div class="hint">رمز عبور باید شامل حروف بزرگ و کوچک، اعداد و علائم ویژه باشد</div>
                </div>

                <div class="form-group">
                    <label for="id_confirm_password">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15 9H16C16.5523 9 17 9.44772 17 10V17C17 17.5523 16.5523 18 16 18H4C3.44772 18 3 17.5523 3 17V10C3 9.44772 3.44772 9 4 9H5V7C5 4.23858 7.23858 2 10 2C12.7614 2 15 4.23858 15 7V9ZM13 9V7C13 5.34315 11.6569 4 10 4C8.34315 4 7 5.34315 7 7V9H13ZM11 13C11 13.5523 10.5523 14 10 14C9.44772 14 9 13.5523 9 13C9 12.4477 9.44772 12 10 12C10.5523 12 11 12.4477 11 13Z" fill="#64748B"/>
                        </svg>
                        تأیید رمز عبور
                    </label>
                    <div class="password-input">
                        <input
                            type="password"
                            name="confirm_password"
                            id="id_confirm_password"
                            required
                            placeholder="تکرار رمز عبور جدید"
                            autocomplete="new-password"
                        >
                        <button type="button" class="toggle-password">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9.99992 4.16675C5.83325 4.16675 2.27492 6.66675 0.833252 10.4167C2.27492 14.1667 5.83325 16.6667 9.99992 16.6667C14.1666 16.6667 17.7249 14.1667 19.1666 10.4167C17.7249 6.66675 14.1666 4.16675 9.99992 4.16675ZM9.99992 14.5834C7.69992 14.5834 5.83325 12.7167 5.83325 10.4167C5.83325 8.11675 7.69992 6.25008 9.99992 6.25008C12.2999 6.25008 14.1666 8.11675 14.1666 10.4167C14.1666 12.7167 12.2999 14.5834 9.99992 14.5834ZM9.99992 7.91675C8.61659 7.91675 7.49992 9.03341 7.49992 10.4167C7.49992 11.8001 8.61659 12.9167 9.99992 12.9167C11.3833 12.9167 12.4999 11.8001 12.4999 10.4167C12.4999 9.03341 11.3833 7.91675 9.99992 7.91675Z" fill="#64748B"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.5 3.33325H2.5C2.03976 3.33325 1.66667 3.70635 1.66667 4.16659V15.8333C1.66667 16.2935 2.03976 16.6666 2.5 16.6666H17.5C17.9602 16.6666 18.3333 16.2935 18.3333 15.8333V4.16659C18.3333 3.70635 17.9602 3.33325 17.5 3.33325Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5 7.5H7.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5 10.8333H10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5 14.1667H15" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    ذخیره تغییرات
                </button>
            </form>
        </div>

        <div class="auth-footer">
            <p>سیستم مدیریت محتوا © {% now "Y" %}</p>
        </div>
    </div>
</div>

<style>
:root {
    --primary: #4361EE;
    --primary-dark: #3A56D4;
    --error: #DC2626;
    --success: #10B981;
    --warning: #F59E0B;
    --gray-100: #F1F5F9;
    --gray-200: #E2E8F0;
    --gray-300: #CBD5E1;
    --gray-400: #94A3B8;
    --gray-500: #64748B;
    --gray-600: #475569;
    --gray-700: #334155;
    --gray-800: #1E293B;
    --gray-900: #0F172A;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--gray-100);
    color: var(--gray-800);
    line-height: 1.6;
}

.superuser-password-reset {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
}

.auth-container {
    max-width: 480px;
    width: 100%;
    margin: 0 auto;
}

.auth-header {
    text-align: center;
    margin-bottom: 2.5rem;
}

.auth-header .logo {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.auth-header .logo svg {
    flex-shrink: 0;
}

.auth-header .logo span {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--gray-900);
}

.auth-header h1 {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--gray-900);
    margin-bottom: 0.5rem;
}

.auth-header .subtitle {
    font-size: 1rem;
    color: var(--gray-500);
}

.auth-card {
    background-color: white;
    border-radius: 1rem;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
    padding: 2.5rem;
    margin-bottom: 2rem;
}

.auth-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-group label {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--gray-700);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.password-input {
    position: relative;
}

.password-input input {
    color: #1b263b !important;
    text-align: center;
    width: 100%;
    padding: 0.875rem 1rem;
    border: 1px solid var(--gray-200);
    border-radius: 0.75rem;
    font-size: 0.9375rem;
    transition: all 0.2s;
    background-color: var(--gray-100);
}

.password-input input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    background-color: white;
}

.password-input .toggle-password {
    position: absolute;
    top: 50%;
    right: 1rem;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.25rem;
    color: var(--gray-400);
    transition: color 0.2s;
}

.password-input .toggle-password:hover {
    color: var(--gray-600);
}

.password-strength {
    height: 4px;
    background-color: var(--gray-200);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 0.25rem;
}

.strength-meter {
    height: 100%;
    width: 0%;
    transition: width 0.3s ease, background-color 0.3s ease;
}

.hint {
    font-size: 0.75rem;
    color: var(--gray-400);
    margin-top: 0.25rem;
}

.submit-btn {
    background-color: var(--primary);
    color: white;
    border: none;
    border-radius: 0.75rem;
    padding: 1rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.submit-btn:hover {
    background-color: var(--primary-dark);
}

.alert {
    padding: 1rem;
    border-radius: 0.75rem;
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.alert-error {
    background-color: rgba(220, 38, 38, 0.1);
    border-left: 4px solid var(--error);
    color: var(--error);
}

.alert svg {
    flex-shrink: 0;
}

.alert ul {
    list-style: none;
    margin-top: 0.5rem;
}

.auth-footer {
    text-align: center;
    font-size: 0.875rem;
    color: var(--gray-400);
}

@media (max-width: 480px) {
    .auth-card {
        padding: 1.5rem;
    }

    .auth-header h1 {
        font-size: 1.5rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- Toggle Password Visibility (بدون تغییر) ---
    const toggleButtons = document.querySelectorAll('.toggle-password');
    toggleButtons.forEach(button => {
        button.addEventListener('click', function() {
            const input = this.parentElement.querySelector('input');
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);

            const icon = this.querySelector('svg');
            if (type === 'text') {
                icon.innerHTML = '<path d="M9.99992 4.16675C5.83325 4.16675 2.27492 6.66675 0.833252 10.4167C2.27492 14.1667 5.83325 16.6667 9.99992 16.6667C14.1666 16.6667 17.7249 14.1667 19.1666 10.4167C17.7249 6.66675 14.1666 4.16675 9.99992 4.16675ZM9.99992 14.5834C7.69992 14.5834 5.83325 12.7167 5.83325 10.4167C5.83325 8.11675 7.69992 6.25008 9.99992 6.25008C12.2999 6.25008 14.1666 8.11675 14.1666 10.4167C14.1666 12.7167 12.2999 14.5834 9.99992 14.5834ZM9.99992 7.91675C8.61659 7.91675 7.49992 9.03341 7.49992 10.4167C7.49992 11.8001 8.61659 12.9167 9.99992 12.9167C11.3833 12.9167 12.4999 11.8001 12.4999 10.4167C12.4999 9.03341 11.3833 7.91675 9.99992 7.91675Z" fill="#64748B"/><path d="M3.33325 2.5L16.6666 17.5" stroke="#64748B" stroke-width="2" stroke-linecap="round"/>';
            } else {
                icon.innerHTML = '<path d="M9.99992 4.16675C5.83325 4.16675 2.27492 6.66675 0.833252 10.4167C2.27492 14.1667 5.83325 16.6667 9.99992 16.6667C14.1666 16.6667 17.7249 14.1667 19.1666 10.4167C17.7249 6.66675 14.1666 4.16675 9.99992 4.16675ZM9.99992 14.5834C7.69992 14.5834 5.83325 12.7167 5.83325 10.4167C5.83325 8.11675 7.69992 6.25008 9.99992 6.25008C12.2999 6.25008 14.1666 8.11675 14.1666 10.4167C14.1666 12.7167 12.2999 14.5834 9.99992 14.5834ZM9.99992 7.91675C8.61659 7.91675 7.49992 9.03341 7.49992 10.4167C7.49992 11.8001 8.61659 12.9167 9.99992 12.9167C11.3833 12.9167 12.4999 11.8001 12.4999 10.4167C12.4999 9.03341 11.3833 7.91675 9.99992 7.91675Z" fill="#64748B"/>';
            }
        });
    });

    // --- Password Validation + Strength Meter ---
    const passwordInput = document.getElementById('id_new_password');
    const strengthMeter = document.querySelector('.strength-meter');
    const errorText = document.createElement('p'); // ایجاد عنصر خطا
    errorText.className = 'error-message';
    errorText.style.color = 'var(--error)';
    errorText.style.fontSize = '0.75rem';
    errorText.style.marginTop = '0.25rem';
    errorText.style.display = 'none';
    passwordInput.parentElement.appendChild(errorText);

    passwordInput.addEventListener('input', function() {
        const password = this.value;

        // بررسی کاراکترهای غیرمجاز
        const hasInvalidChars = /[^a-zA-Z0-9!@#$%^&*]/.test(password);

        if (hasInvalidChars) {
            errorText.textContent = 'فقط حروف انگلیسی، اعداد و کاراکترهای !@#$%^.&* مجاز هستند!';
            errorText.style.display = 'block';
            strengthMeter.style.width = '0%';
            return;
        } else {
            errorText.style.display = 'none';
        }

        // محاسبه قدرت رمز عبور
        let strength = 0;

        // طول رمز عبور
        if (password.length >= 8) strength += 25;

        // حروف کوچک
        if (/[a-z]/.test(password)) strength += 15;

        // حروف بزرگ
        if (/[A-Z]/.test(password)) strength += 15;

        // اعداد
        if (/[0-9]/.test(password)) strength += 20;

        // کاراکترهای خاص
        if (/[!@#$%^&*]/.test(password)) strength += 25;

        // نمایش قدرت
        strengthMeter.style.width = strength + '%';
        strengthMeter.style.backgroundColor =
            strength < 30 ? 'var(--error)' :
            strength < 60 ? 'var(--warning)' :
            strength < 80 ? '#3B82F6' : 'var(--success)';
    });

    // جلوگیری از ثبت فرم اگر رمز عبور نامعتبر است
    const form = document.querySelector('.auth-form');
    form.addEventListener('submit', function(e) {
        const password = passwordInput.value;
        if (/[^a-zA-Z0-9!@#$%^&*]/.test(password)) {
            e.preventDefault();
            errorText.textContent = 'لطفاً کاراکترهای غیرمجاز را حذف کنید!';
            errorText.style.display = 'block';
        }
    });
});
</script>
{% endblock %}